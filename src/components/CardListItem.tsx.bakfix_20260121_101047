import React from "react";
import { View, Text, StyleSheet, Image } from "react-native";
import { theme } from "../theme";
import type { SimpleCard } from "../hooks/useGallery";

export function CardListItem({ card, selected }: { card: SimpleCard; selected?: boolean }) {
  // ✅ VRAIE CARTE SORARE
  const img = card.pictureUrl || card.avatarUrl || null;

  return (
    <View style={[styles.wrap, selected ? styles.selected : null]}>
      <View style={styles.thumbWrap}>
        {img ? (
          <Image source={{ uri: img }} style={styles.thumbImg} resizeMode="contain" />
        ) : (
          <View style={styles.fallback}>
            <Text style={{ color: theme.colors.textMuted, fontWeight: "900" }}>?</Text>
          </View>
        )}
      </View>

      <View style={{ flex: 1 }}>
        <Text style={styles.title} numberOfLines={1}>
          {card.playerName ?? "?"}
        </Text>
        <Text style={styles.subtitle} numberOfLines={1}>
          {(card.teamName ?? "?") + " • " + (card.season ?? (card.seasonYear ? String(card.seasonYear) : "?"))}
        </Text>

        <View style={styles.badgesRow}>
          <View style={[styles.badge, { backgroundColor: "rgba(226,59,91,0.18)" }]}>
            <Text style={[styles.badgeText, { color: theme.colors.text }]}>
              {(card.rarity ?? "?").replace("_", " ")}
            </Text>
          </View>

          <View style={[styles.badge, { backgroundColor: "rgba(255,255,255,0.10)" }]}>
            <Text style={[styles.badgeText, { color: theme.colors.text }]}>
              {card.position ?? "?"}
            </Text>
          </View>
        </View>

        <Text style={styles.meta} numberOfLines={1}>
          {card.slug}
        </Text>
      </View>
    </View>
  );
}

const styles = StyleSheet.create({
  wrap: {
    flexDirection: "row",
    gap: 12,
    backgroundColor: theme.colors.card,
    borderRadius: theme.radius.lg,
    padding: 12,
    borderWidth: 1,
    borderColor: theme.colors.border,
    marginBottom: 10,
  },
  selected: {
    borderColor: "rgba(226,59,91,0.70)",
    backgroundColor: "rgba(226,59,91,0.10)",
  },
  thumbWrap: {
    width: 92,
    height: 128,
    borderRadius: theme.radius.md,
    overflow: "hidden",
    backgroundColor: theme.colors.card2,
    alignItems: "center",
    justifyContent: "center",
  },
  thumbImg: { width: "100%", height: "100%" },
  fallback: { width: "100%", height: "100%", alignItems: "center", justifyContent: "center" },
  title: { color: theme.colors.text, fontWeight: "900", fontSize: 15 },
  subtitle: { marginTop: 4, color: theme.colors.textMuted, fontWeight: "700" },
  meta: { marginTop: 8, color: theme.colors.textMuted, fontWeight: "600", fontSize: 12 },
  badgesRow: { flexDirection: "row", flexWrap: "wrap", marginTop: 8, gap: 8 },
  badge: { paddingVertical: 6, paddingHorizontal: 10, borderRadius: theme.radius.pill },
  badgeText: { fontWeight: "900", fontSize: 12 },
});
